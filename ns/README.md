#![НаноШакал](https://github.com/desudesutalk/randomtrash/raw/master/ns/icon.jpg)НаноШакал

Скрипт предназначен для [Наноборды](https://github.com/nanoboard/nanoboard).

Это пользовательский скрипт, для его работы потребуется [Greasemonkey](https://addons.mozilla.org/ru/firefox/addon/greasemonkey/) в Фаерфоксе или [Tampermonkey](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo?hl=ru) в Гугл Хроме.

**[Установить скрипт](https://github.com/desudesutalk/randomtrash/raw/master/ns/ns.user.js)**

##Что добавляет скрипт
Во-первых: скрипт добавляет поддержку [формата BPG](http://bellard.org/bpg/) (Только 8бит. Зато с анимацией). BPG это *новый эксперементальный* формат для зашакаливания картинок. Насколько хорошо он с этим справляется можно [заценить на сайте сравнений](http://xooyoozoo.github.io/yolo-octo-bugfixes/#vintage-car&jpg=t&bpg=t). Такие картинки придётся генерить самостоятельно при помощи тулзы которая скачивается с сайта автора.

Во-вторых: добавляется [поддержка формата webp](https://github.com/antimatter15/weppy) для не особо хромых браузеров. Такие картинки тоже надо пилить самостоятельно. Например [гугловскими тулзами](https://developers.google.com/speed/webp/download). Либо ставим Гуглохром и смотрим на третий бонус.

В-третьих: и это наверное **самое интересное**. В форму ответа добавляется инструментарий для зашакаливания картинок.

![форма](https://github.com/desudesutalk/randomtrash/raw/master/ns/replyform.png)

Жмём кнопку `Пришакалить картинку` и выбираем любой интересующий нас файл. Далее при помощи двух ползунков регулируем желаемое качество (от 0 до 100) и желаемый размер картинки в символах после перекодирования в base64 (от 128 до 32768 с шагом в 128). В Гуглохроме будет возможность шакалить картинки в формате webp, в остальных браузерах только jpeg.

Подобрав удовлетворительные параметры, жмём `Добавить!` и зашакаленная картинка вставится в форму ответа как тег `[img=]`.

Кроме этого, если выбранный файл уже попадает под установленный максимальный размер, то он будет вставлен в форму ответа сразу без дополнительной обработки.

**ВАЖНО:** алгоритм зашакаливания довольно кривой и бывает что ошибается делая картинки больше чем надо. И не всегда способен выдержать выставленное качество сжатия. Кроме того кодеки в браузере ориентированы на скорость, а не на максимальное сжатие, так что делая картинки руками вы добьётесь лучших результатов.

И ещё бонус: так как в качестве картинок можно приложить совершенно любой файл, то добавлен детектор 7z/zip/rar архивов. Такие "картинки" превращаются в ссылку `attachment` кликнув по которой можно архив скачать. А так же детектятся Ogg файлы и вставляются как тег аудио - можно прямо сразу слушать. (Если взять Opus то можно в 24кб засунуть почти 30 секунд звука)
